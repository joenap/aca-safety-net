# Claude Code Security Hook Configuration
# Copy to ~/.claude/security-hook.toml

# Sensitive file patterns (applied to Bash commands and Read file_path)
# Note: TOML single-quoted strings are literal - use single backslash for regex
sensitive_files = [
    '\.env\b',
    '\.envrc\b',
    'credentials',
    'secrets',
    '\.netrc\b',
    '\.npmrc\b',
    '\.pypirc\b',
    '\.pem\b',
    '\.key\b',
    'id_rsa',
    'id_ed25519',
    'id_ecdsa',
    '\.git-credentials',
    'kubeconfig',
    '\.aws/credentials',
    '\.config/gcloud/',
    '\.config/gh/hosts\.yml',
    '_history\b',
    '\.bash_history',
    '\.zsh_history',
]

# Commands that read file content (only block these + sensitive_files combo)
read_commands = '\b(cat|head|tail|less|more|grep|rg|ag|sed|awk|strings|xxd|hexdump|bat|view)\b'

# Always block these patterns (env exposure)
[[deny]]
tool = "Bash"
pattern = '^\s*printenv'
reason = "Exposes environment variables"

[[deny]]
tool = "Bash"
pattern = '^\s*set\s*$'
reason = "Exposes shell variables"

[[deny]]
tool = "Bash"
pattern = '^\s*declare\s+-x'
reason = "Exposes exported variables"

[[deny]]
tool = "Bash"
pattern = '^\s*export\s*$'
reason = "Exposes exported variables"

[[deny]]
tool = "Bash"
pattern = '/proc/.*/environ'
reason = "Exposes process environment"

[[deny]]
tool = "Bash"
pattern = '\bps\b.*(-E|auxe)'
reason = "Exposes process environment"

[[deny]]
tool = "Bash"
pattern = '\b(docker|podman)\s+(exec|run)\b.*\benv\b'
reason = "Exposes container environment"

[[deny]]
tool = "Bash"
pattern = '\b(docker|podman)\s+inspect\b'
reason = "Exposes container configuration"

[[deny]]
tool = "Bash"
pattern = '\b(docker-compose|docker\s+compose)\s+exec\b.*\benv\b'
reason = "Exposes container environment"

# Dependency file protection
# Requires user approval before editing package manifests
# Encourages using CLI tools (cargo add, uv add, npm install, etc.)
[dependencies]
enabled = true
patterns = [
    '(^|/)Cargo\.toml$',
    '(^|/)pyproject\.toml$',
    '(^|/)package\.json$',
    '(^|/)requirements\.txt$',
    '(^|/)Gemfile$',
    '(^|/)go\.mod$',
    '(^|/)pom\.xml$',
    '(^|/)build\.gradle(\.kts)?$',
    '(^|/)composer\.json$',
    '(^|/)Package\.swift$',
]
suggestion = "Use package manager CLI (cargo add, uv add, npm install, etc.) instead of editing directly"
